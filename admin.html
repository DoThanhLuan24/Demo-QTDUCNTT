<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Admin - Qu·∫£n l√Ω L·ªõp Ti·∫øng Anh</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Segoe UI", sans-serif;
                background: #f5f7fa;
                color: #333;
            }

            .header {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 1rem 0;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            .header__content {
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 1rem;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .header__logo {
                font-size: 1.5rem;
                font-weight: bold;
            }

            .btn-logout {
                background: rgba(255, 255, 255, 0.2);
                border: 2px solid rgba(255, 255, 255, 0.3);
                color: white;
                padding: 0.5rem 1rem;
                border-radius: 20px;
                cursor: pointer;
                transition: all 0.3s;
            }

            .btn-logout:hover {
                background: rgba(255, 255, 255, 0.3);
            }

            .container {
                max-width: 1200px;
                margin: 2rem auto;
                padding: 0 1rem;
            }

            .stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1.5rem;
                margin-bottom: 2rem;
            }

            .stat-card {
                background: white;
                padding: 1.5rem;
                border-radius: 12px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
                border-left: 4px solid #667eea;
            }

            .stat-card__number {
                font-size: 2rem;
                font-weight: bold;
                color: #667eea;
                margin-bottom: 0.5rem;
            }

            .stat-card__label {
                color: #666;
                font-size: 0.875rem;
            }

            .section {
                background: white;
                padding: 2rem;
                border-radius: 12px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
                margin-bottom: 2rem;
            }

            .section__title {
                font-size: 1.5rem;
                margin-bottom: 1.5rem;
                color: #333;
            }

            .form {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin-bottom: 2rem;
            }

            .form__group {
                display: flex;
                flex-direction: column;
            }

            .form__label {
                margin-bottom: 0.5rem;
                font-weight: 600;
                font-size: 0.875rem;
                color: #555;
            }

            .form__input,
            .form__select {
                padding: 0.75rem;
                border: 2px solid #e1e5f2;
                border-radius: 8px;
                font-size: 0.875rem;
                transition: border-color 0.3s;
            }

            .form__input:focus,
            .form__select:focus {
                outline: none;
                border-color: #667eea;
            }

            .btn {
                padding: 0.75rem 1.5rem;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-weight: 600;
                transition: all 0.3s;
            }

            .btn--primary {
                background: #667eea;
                color: white;
            }

            .btn--success {
                background: #48bb78;
                color: white;
            }

            .btn--danger {
                background: #f56565;
                color: white;
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }

            .btn--info {
                background: #4299e1;
                color: white;
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }

            .btn--warning {
                background: #ed8936;
                color: white;
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }

            .btn:hover {
                opacity: 0.9;
                transform: translateY(-2px);
            }

            .table {
                width: 100%;
                border-collapse: collapse;
                overflow: hidden;
                border-radius: 8px;
            }

            .table__head {
                background: #667eea;
                color: white;
            }

            .table th,
            .table td {
                padding: 1rem;
                text-align: left;
                border-bottom: 1px solid #f1f3f4;
            }

            .table tbody tr:hover {
                background: #f8f9ff;
            }

            .badge {
                display: inline-block;
                padding: 0.25rem 0.75rem;
                border-radius: 12px;
                font-size: 0.75rem;
                font-weight: 600;
            }

            .badge--remedial {
                background: #fed7d7;
                color: #c53030;
            }

            .badge--official {
                background: #bee3f8;
                color: #2c5282;
            }

            .badge--active {
                background: #c6f6d5;
                color: #22543d;
            }

            .badge--full {
                background: #fed7d7;
                color: #c53030;
            }

            .actions {
                display: flex;
                gap: 0.5rem;
                flex-wrap: wrap;
            }

            .alert {
                padding: 1rem;
                border-radius: 8px;
                margin-bottom: 1.5rem;
                border-left: 4px solid;
                animation: slideIn 0.3s;
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .alert--success {
                background: #d1fae5;
                color: #065f46;
                border-color: #10b981;
            }

            .alert--error {
                background: #fee2e2;
                color: #991b1b;
                border-color: #ef4444;
            }

            /* Modal */
            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 1000;
                align-items: center;
                justify-content: center;
            }

            .modal.active {
                display: flex;
            }

            .modal__content {
                background: white;
                padding: 2rem;
                border-radius: 12px;
                max-width: 600px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
                animation: modalSlideIn 0.3s;
            }

            @keyframes modalSlideIn {
                from {
                    opacity: 0;
                    transform: scale(0.9);
                }
                to {
                    opacity: 1;
                    transform: scale(1);
                }
            }

            .modal__header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1.5rem;
            }

            .modal__title {
                font-size: 1.5rem;
                color: #333;
            }

            .modal__close {
                background: none;
                border: none;
                font-size: 1.5rem;
                cursor: pointer;
                color: #999;
            }

            .modal__close:hover {
                color: #333;
            }

            .student-list {
                max-height: 300px;
                overflow-y: auto;
                border: 2px solid #e1e5f2;
                border-radius: 8px;
                padding: 1rem;
            }

            .student-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.75rem;
                border-bottom: 1px solid #f1f3f4;
            }

            .student-item:last-child {
                border-bottom: none;
            }

            .student-info {
                flex: 1;
            }

            .student-name {
                font-weight: 600;
                color: #333;
            }

            .student-id {
                font-size: 0.875rem;
                color: #666;
            }

            @media (max-width: 768px) {
                .stats {
                    grid-template-columns: 1fr;
                }

                .form {
                    grid-template-columns: 1fr;
                }

                .table {
                    font-size: 0.75rem;
                }

                .actions {
                    flex-direction: column;
                }
            }
        </style>
    </head>
    <body>
        <header class="header">
            <div class="header__content">
                <div class="header__logo">üõ°Ô∏è Admin - Qu·∫£n l√Ω Ti·∫øng Anh</div>
                <div style="display: flex; align-items: center; gap: 1rem">
                    <span id="userName">ƒêang t·∫£i...</span>
                    <button class="btn-logout" onclick="logout()">
                        ƒêƒÉng xu·∫•t
                    </button>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- Th·ªëng k√™ -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-card__number" id="totalCourses">0</div>
                    <div class="stat-card__label">T·ªïng s·ªë l·ªõp</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card__number" id="totalStudents">0</div>
                    <div class="stat-card__label">T·ªïng sinh vi√™n</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card__number" id="totalEnrollments">0</div>
                    <div class="stat-card__label">L∆∞·ª£t ƒëƒÉng k√Ω</div>
                </div>
            </div>

            <!-- Form Th√™m L·ªõp h·ªçc -->
            <div class="section">
                <h2 class="section__title">Th√™m l·ªõp h·ªçc</h2>
                <form class="form" id="courseForm">
                    <div class="form__group">
                        <label class="form__label">T√™n l·ªõp</label>
                        <input
                            class="form__input"
                            type="text"
                            id="courseName"
                            placeholder="VD: Ti·∫øng Anh C∆° B·∫£n"
                            required
                        />
                    </div>
                    <div class="form__group">
                        <label class="form__label">M√£ l·ªõp</label>
                        <input
                            class="form__input"
                            type="text"
                            id="courseCode"
                            placeholder="VD: ENG_101"
                            required
                        />
                    </div>
                    <div class="form__group">
                        <label class="form__label">Lo·∫°i l·ªõp</label>
                        <select class="form__select" id="courseType" required>
                            <option value="remedial">TƒÉng C∆∞·ªùng</option>
                            <option value="official">Ch√≠nh Th·ª©c</option>
                        </select>
                    </div>
                    <div class="form__group">
                        <label class="form__label">Gi·∫£ng vi√™n</label>
                        <input
                            class="form__input"
                            type="text"
                            id="courseInstructor"
                            placeholder="VD: Ms. Johnson"
                            required
                        />
                    </div>
                    <div class="form__group">
                        <label class="form__label">Sƒ© s·ªë t·ªëi ƒëa</label>
                        <input
                            class="form__input"
                            type="number"
                            id="courseMaxStudents"
                            min="10"
                            placeholder="30"
                            required
                        />
                    </div>
                    <div class="form__group">
                        <label class="form__label">&nbsp;</label>
                        <button class="btn btn--success" type="submit">
                            ‚ûï Th√™m l·ªõp
                        </button>
                    </div>
                </form>
            </div>

            <!-- Danh s√°ch L·ªõp h·ªçc -->
            <div class="section">
                <h2 class="section__title">Danh s√°ch l·ªõp h·ªçc</h2>
                <table class="table">
                    <thead class="table__head">
                        <tr>
                            <th>M√£ l·ªõp</th>
                            <th>T√™n l·ªõp</th>
                            <th>Lo·∫°i</th>
                            <th>Gi·∫£ng vi√™n</th>
                            <th>Sƒ© s·ªë</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="coursesTableBody">
                        <tr>
                            <td
                                colspan="7"
                                style="text-align: center; color: #999"
                            >
                                ƒêang t·∫£i d·ªØ li·ªáu...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Form Th√™m Sinh vi√™n -->
            <div class="section">
                <h2 class="section__title">Th√™m sinh vi√™n</h2>
                <form class="form" id="studentForm">
                    <div class="form__group">
                        <label class="form__label">M√£ sinh vi√™n</label>
                        <input
                            class="form__input"
                            type="text"
                            id="studentId"
                            placeholder="VD: SV001"
                            required
                        />
                    </div>
                    <div class="form__group">
                        <label class="form__label">H·ªç v√† t√™n</label>
                        <input
                            class="form__input"
                            type="text"
                            id="studentName"
                            placeholder="VD: Nguy·ªÖn VƒÉn A"
                            required
                        />
                    </div>
                    <div class="form__group">
                        <label class="form__label">Email</label>
                        <input
                            class="form__input"
                            type="email"
                            id="studentEmail"
                            placeholder="VD: student@email.com"
                            required
                        />
                    </div>
                    <div class="form__group">
                        <label class="form__label">ƒêi·ªÉm THPT</label>
                        <input
                            class="form__input"
                            type="number"
                            id="studentScore"
                            min="0"
                            max="10"
                            step="0.1"
                            placeholder="VD: 7.5"
                            required
                        />
                    </div>
                    <div class="form__group">
                        <label class="form__label">M·∫≠t kh·∫©u</label>
                        <input
                            class="form__input"
                            type="password"
                            id="studentPassword"
                            placeholder="M·∫≠t kh·∫©u ƒëƒÉng nh·∫≠p"
                            required
                        />
                    </div>
                    <div class="form__group">
                        <label class="form__label">&nbsp;</label>
                        <button class="btn btn--success" type="submit">
                            ‚ûï Th√™m sinh vi√™n
                        </button>
                    </div>
                </form>
            </div>

            <!-- Danh s√°ch Sinh vi√™n -->
            <div class="section">
                <h2 class="section__title">Danh s√°ch sinh vi√™n</h2>
                <table class="table">
                    <thead class="table__head">
                        <tr>
                            <th>M√£ SV</th>
                            <th>H·ªç t√™n</th>
                            <th>T√™n ƒëƒÉng nh·∫≠p</th>
                            <th>Email</th>
                            <th>ƒêi·ªÉm THPT</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTableBody">
                        <tr>
                            <td
                                colspan="6"
                                style="text-align: center; color: #999"
                            >
                                ƒêang t·∫£i d·ªØ li·ªáu...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Modal Qu·∫£n l√Ω Sinh vi√™n trong L·ªõp -->
        <div class="modal" id="manageStudentsModal">
            <div class="modal__content">
                <div class="modal__header">
                    <h3 class="modal__title">
                        Qu·∫£n l√Ω Sinh vi√™n - <span id="modalCourseName"></span>
                    </h3>
                    <button class="modal__close" onclick="closeModal()">
                        &times;
                    </button>
                </div>

                <h4 style="margin-bottom: 1rem">
                    Sinh vi√™n trong l·ªõp (<span id="enrolledCount">0</span>)
                </h4>
                <div class="student-list" id="enrolledStudents">
                    <p style="text-align: center; color: #999">
                        Ch∆∞a c√≥ sinh vi√™n n√†o
                    </p>
                </div>

                <h4 style="margin: 1.5rem 0 1rem">Th√™m sinh vi√™n v√†o l·ªõp</h4>
                <div class="form__group">
                    <label class="form__label">Ch·ªçn sinh vi√™n</label>
                    <select class="form__select" id="studentToAdd">
                        <option value="">-- Ch·ªçn sinh vi√™n --</option>
                    </select>
                </div>
                <button
                    class="btn btn--primary"
                    onclick="addStudentToCourse()"
                    style="width: 100%; margin-top: 1rem"
                >
                    ‚ûï Th√™m v√†o l·ªõp
                </button>
            </div>
        </div>

        <!-- Modal S·ª≠a L·ªõp h·ªçc -->
        <div class="modal" id="editCourseModal">
            <div class="modal__content">
                <div class="modal__header">
                    <h3 class="modal__title">S·ª≠a th√¥ng tin l·ªõp h·ªçc</h3>
                    <button class="modal__close" onclick="closeEditModal()">
                        &times;
                    </button>
                </div>

                <form id="editCourseForm">
                    <input type="hidden" id="editCourseId" />
                    <div class="form__group" style="margin-bottom: 1rem">
                        <label class="form__label">T√™n l·ªõp</label>
                        <input
                            class="form__input"
                            type="text"
                            id="editCourseName"
                            required
                        />
                    </div>
                    <div class="form__group" style="margin-bottom: 1rem">
                        <label class="form__label">M√£ l·ªõp</label>
                        <input
                            class="form__input"
                            type="text"
                            id="editCourseCode"
                            required
                        />
                    </div>
                    <div class="form__group" style="margin-bottom: 1rem">
                        <label class="form__label">Lo·∫°i l·ªõp</label>
                        <select
                            class="form__select"
                            id="editCourseType"
                            required
                        >
                            <option value="remedial">TƒÉng C∆∞·ªùng</option>
                            <option value="official">Ch√≠nh Th·ª©c</option>
                        </select>
                    </div>
                    <div class="form__group" style="margin-bottom: 1rem">
                        <label class="form__label">Gi·∫£ng vi√™n</label>
                        <input
                            class="form__input"
                            type="text"
                            id="editCourseInstructor"
                            required
                        />
                    </div>
                    <div class="form__group" style="margin-bottom: 1rem">
                        <label class="form__label">Sƒ© s·ªë t·ªëi ƒëa</label>
                        <input
                            class="form__input"
                            type="number"
                            id="editCourseMaxStudents"
                            min="10"
                            required
                        />
                    </div>
                    <button
                        class="btn btn--success"
                        type="submit"
                        style="width: 100%"
                    >
                        üíæ L∆∞u thay ƒë·ªïi
                    </button>
                </form>
            </div>
        </div>

        <!-- Modal S·ª≠a Sinh vi√™n -->
        <div class="modal" id="editStudentModal">
            <div class="modal__content">
                <div class="modal__header">
                    <h3 class="modal__title">S·ª≠a th√¥ng tin sinh vi√™n</h3>
                    <button
                        class="modal__close"
                        onclick="closeEditStudentModal()"
                    >
                        &times;
                    </button>
                </div>

                <form id="editStudentForm">
                    <input type="hidden" id="editStudentOriginalId" />
                    <div class="form__group" style="margin-bottom: 1rem">
                        <label class="form__label">M√£ sinh vi√™n</label>
                        <input
                            class="form__input"
                            type="text"
                            id="editStudentId"
                            required
                        />
                    </div>
                    <div class="form__group" style="margin-bottom: 1rem">
                        <label class="form__label">H·ªç v√† t√™n</label>
                        <input
                            class="form__input"
                            type="text"
                            id="editStudentName"
                            required
                        />
                    </div>
                    <div class="form__group" style="margin-bottom: 1rem">
                        <label class="form__label">Email</label>
                        <input
                            class="form__input"
                            type="email"
                            id="editStudentEmail"
                            required
                        />
                    </div>
                    <div class="form__group" style="margin-bottom: 1rem">
                        <label class="form__label">ƒêi·ªÉm THPT</label>
                        <input
                            class="form__input"
                            type="number"
                            id="editStudentScore"
                            min="0"
                            max="10"
                            step="0.1"
                            required
                        />
                    </div>
                    <div class="form__group" style="margin-bottom: 1rem">
                        <label class="form__label"
                            >M·∫≠t kh·∫©u m·ªõi (ƒë·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi)</label
                        >
                        <input
                            class="form__input"
                            type="password"
                            id="editStudentPassword"
                            placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi ho·∫∑c ƒë·ªÉ tr·ªëng"
                        />
                    </div>
                    <button
                        class="btn btn--success"
                        type="submit"
                        style="width: 100%"
                    >
                        üíæ L∆∞u thay ƒë·ªïi
                    </button>
                </form>
            </div>
        </div>

        <script>
            // ============================================
            // DATA MANAGEMENT
            // ============================================
            let appData = {
                courses: [],
                students: [],
                enrollments: [],
                currentUser: null,
                editingCourseId: null,
                managingCourseId: null,
            };

            // ============================================
            // INITIALIZATION
            // ============================================
            document.addEventListener("DOMContentLoaded", function () {
                console.log("üöÄ Kh·ªüi ƒë·ªông ·ª©ng d·ª•ng Admin...");
                checkAuth();
                loadData();
                updateStats();
                renderCourses();
                renderStudents();

                // Event Listeners
                document
                    .getElementById("courseForm")
                    .addEventListener("submit", handleAddCourse);
                document
                    .getElementById("editCourseForm")
                    .addEventListener("submit", handleEditCourse);
                document
                    .getElementById("studentForm")
                    .addEventListener("submit", handleAddStudent);
                document
                    .getElementById("editStudentForm")
                    .addEventListener("submit", handleEditStudent);

                console.log("‚úÖ ·ª®ng d·ª•ng ƒë√£ s·∫µn s√†ng!");
            });

            // ============================================
            // AUTHENTICATION
            // ============================================
            function checkAuth() {
                const user = localStorage.getItem("currentUser");
                if (!user) {
                    alert("‚ö†Ô∏è Vui l√≤ng ƒëƒÉng nh·∫≠p!");
                    window.location.href = "register&login.html";
                    return;
                }

                const userData = JSON.parse(user);
                if (userData.role !== "admin") {
                    alert("‚ùå B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p trang n√†y!");
                    window.location.href = "register&login.html";
                    return;
                }

                appData.currentUser = userData;
                document.getElementById("userName").textContent =
                    userData.name || userData.email;
                console.log("‚úÖ X√°c th·ª±c th√†nh c√¥ng:", userData.email);
            }

            function logout() {
                if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?")) {
                    localStorage.removeItem("currentUser");
                    console.log("üëã ƒêƒÉng xu·∫•t th√†nh c√¥ng!");
                    window.location.href = "register&login.html";
                }
            }

            // ============================================
            // DATA LOADING & SAVING
            // ============================================
            function loadData() {
                console.log("üìÇ ƒêang t·∫£i d·ªØ li·ªáu...");

                // Load Courses
                const savedCourses = localStorage.getItem("courses");
                if (savedCourses) {
                    appData.courses = JSON.parse(savedCourses);
                    console.log(`‚úÖ ƒê√£ t·∫£i ${appData.courses.length} l·ªõp h·ªçc`);
                } else {
                    // D·ªØ li·ªáu m·∫´u
                    appData.courses = [
                        {
                            id: 1,
                            name: "Ti·∫øng Anh TƒÉng C∆∞·ªùng C∆° B·∫£n",
                            code: "ENG_TC_101",
                            instructor: "Ms. Johnson",
                            type: "remedial",
                            maxStudents: 30,
                        },
                        {
                            id: 2,
                            name: "Ti·∫øng Anh Ch√≠nh Th·ª©c A1",
                            code: "ENG_CT_A1",
                            instructor: "Mr. Smith",
                            type: "official",
                            maxStudents: 35,
                        },
                    ];
                    saveCourses();
                    console.log("‚úÖ ƒê√£ t·∫°o d·ªØ li·ªáu m·∫´u cho l·ªõp h·ªçc");
                }

                // Load Students
                const savedStudents = localStorage.getItem("students");
                if (savedStudents) {
                    appData.students = JSON.parse(savedStudents);
                    console.log(
                        `‚úÖ ƒê√£ t·∫£i ${appData.students.length} sinh vi√™n`
                    );
                } else {
                    appData.students = [];
                    console.log("‚ÑπÔ∏è Ch∆∞a c√≥ sinh vi√™n n√†o");
                }

                // Load Enrollments
                const savedEnrollments = localStorage.getItem("enrollments");
                if (savedEnrollments) {
                    appData.enrollments = JSON.parse(savedEnrollments);
                    console.log(
                        `‚úÖ ƒê√£ t·∫£i ${appData.enrollments.length} ƒëƒÉng k√Ω`
                    );
                } else {
                    appData.enrollments = [];
                    console.log("‚ÑπÔ∏è Ch∆∞a c√≥ ƒëƒÉng k√Ω n√†o");
                }
            }

            function saveCourses() {
                localStorage.setItem(
                    "courses",
                    JSON.stringify(appData.courses)
                );
                console.log("üíæ ƒê√£ l∆∞u danh s√°ch l·ªõp h·ªçc");
            }

            function saveStudents() {
                localStorage.setItem(
                    "students",
                    JSON.stringify(appData.students)
                );

                // ƒê·ªìng b·ªô v·ªõi users
                const users = JSON.parse(localStorage.getItem("users") || "[]");
                appData.students.forEach((student) => {
                    const userIndex = users.findIndex(
                        (u) => u.studentId === student.studentId
                    );
                    if (userIndex !== -1) {
                        users[userIndex] = student;
                    }
                });
                localStorage.setItem("users", JSON.stringify(users));

                console.log("üíæ ƒê√£ l∆∞u danh s√°ch sinh vi√™n");
            }

            function saveEnrollments() {
                localStorage.setItem(
                    "enrollments",
                    JSON.stringify(appData.enrollments)
                );
                console.log("üíæ ƒê√£ l∆∞u danh s√°ch ƒëƒÉng k√Ω");
            }

            // ============================================
            // STATISTICS
            // ============================================
            function updateStats() {
                document.getElementById("totalCourses").textContent =
                    appData.courses.length;
                document.getElementById("totalStudents").textContent =
                    appData.students.length;
                document.getElementById("totalEnrollments").textContent =
                    appData.enrollments.length;
            }

            // ============================================
            // COURSE MANAGEMENT
            // ============================================
            function renderCourses() {
                const tbody = document.getElementById("coursesTableBody");
                tbody.innerHTML = "";

                if (appData.courses.length === 0) {
                    tbody.innerHTML =
                        '<tr><td colspan="7" style="text-align: center; color: #999;">Ch∆∞a c√≥ l·ªõp h·ªçc n√†o</td></tr>';
                    return;
                }

                appData.courses.forEach((course) => {
                    const enrolledCount = appData.enrollments.filter(
                        (e) => e.courseCode === course.code
                    ).length;
                    const isFull = enrolledCount >= course.maxStudents;

                    const row = `
                    <tr>
                        <td style="font-weight: 600; color: #667eea;">${
                            course.code
                        }</td>
                        <td>${course.name}</td>
                        <td><span class="badge badge--${course.type}">${
                        course.type === "remedial" ? "TƒÉng C∆∞·ªùng" : "Ch√≠nh Th·ª©c"
                    }</span></td>
                        <td>${course.instructor}</td>
                        <td>${enrolledCount}/${course.maxStudents}</td>
                        <td><span class="badge badge--${
                            isFull ? "full" : "active"
                        }">${isFull ? "ƒê·∫ßy" : "C√≤n ch·ªó"}</span></td>
                        <td>
                            <div class="actions">
                                <button class="btn btn--warning" onclick="openManageStudents(${
                                    course.id
                                })">üë• Qu·∫£n l√Ω SV</button>
                                <button class="btn btn--info" onclick="openEditCourse(${
                                    course.id
                                })">‚úèÔ∏è S·ª≠a</button>
                                <button class="btn btn--danger" onclick="deleteCourse(${
                                    course.id
                                })">üóëÔ∏è X√≥a</button>
                            </div>
                        </td>
                    </tr>
                `;
                    tbody.innerHTML += row;
                });
            }

            function handleAddCourse(e) {
                e.preventDefault();

                const courseName = document
                    .getElementById("courseName")
                    .value.trim();
                const courseCode = document
                    .getElementById("courseCode")
                    .value.trim();
                const courseType = document.getElementById("courseType").value;
                const courseInstructor = document
                    .getElementById("courseInstructor")
                    .value.trim();
                const courseMaxStudents = parseInt(
                    document.getElementById("courseMaxStudents").value
                );

                // Validation
                if (appData.courses.find((c) => c.code === courseCode)) {
                    showAlert("‚ùå M√£ l·ªõp ƒë√£ t·ªìn t·∫°i!", "error");
                    return;
                }

                const newCourse = {
                    id: Date.now(),
                    name: courseName,
                    code: courseCode,
                    type: courseType,
                    instructor: courseInstructor,
                    maxStudents: courseMaxStudents,
                };

                appData.courses.push(newCourse);
                saveCourses();
                document.getElementById("courseForm").reset();
                updateStats();
                renderCourses();
                showAlert("‚úÖ Th√™m l·ªõp h·ªçc th√†nh c√¥ng!", "success");
                console.log("‚ûï ƒê√£ th√™m l·ªõp:", courseCode);
            }

            function openEditCourse(id) {
                const course = appData.courses.find((c) => c.id === id);
                if (!course) return;

                appData.editingCourseId = id;
                document.getElementById("editCourseId").value = course.id;
                document.getElementById("editCourseName").value = course.name;
                document.getElementById("editCourseCode").value = course.code;
                document.getElementById("editCourseType").value = course.type;
                document.getElementById("editCourseInstructor").value =
                    course.instructor;
                document.getElementById("editCourseMaxStudents").value =
                    course.maxStudents;

                document
                    .getElementById("editCourseModal")
                    .classList.add("active");
            }

            function closeEditModal() {
                document
                    .getElementById("editCourseModal")
                    .classList.remove("active");
                appData.editingCourseId = null;
            }

            function handleEditCourse(e) {
                e.preventDefault();

                const courseId = parseInt(
                    document.getElementById("editCourseId").value
                );
                const courseIndex = appData.courses.findIndex(
                    (c) => c.id === courseId
                );

                if (courseIndex === -1) return;

                const oldCode = appData.courses[courseIndex].code;
                const newCode = document
                    .getElementById("editCourseCode")
                    .value.trim();

                // Ki·ªÉm tra tr√πng m√£ (n·∫øu thay ƒë·ªïi)
                if (
                    newCode !== oldCode &&
                    appData.courses.find((c) => c.code === newCode)
                ) {
                    showAlert("‚ùå M√£ l·ªõp ƒë√£ t·ªìn t·∫°i!", "error");
                    return;
                }

                const updatedCourse = {
                    ...appData.courses[courseIndex],
                    name: document
                        .getElementById("editCourseName")
                        .value.trim(),
                    code: newCode,
                    type: document.getElementById("editCourseType").value,
                    instructor: document
                        .getElementById("editCourseInstructor")
                        .value.trim(),
                    maxStudents: parseInt(
                        document.getElementById("editCourseMaxStudents").value
                    ),
                };

                // C·∫≠p nh·∫≠t m√£ l·ªõp trong enrollments n·∫øu thay ƒë·ªïi
                if (oldCode !== newCode) {
                    appData.enrollments.forEach((enrollment) => {
                        if (enrollment.courseCode === oldCode) {
                            enrollment.courseCode = newCode;
                        }
                    });
                    saveEnrollments();
                }

                appData.courses[courseIndex] = updatedCourse;
                saveCourses();
                renderCourses();
                closeEditModal();
                showAlert("‚úÖ C·∫≠p nh·∫≠t l·ªõp h·ªçc th√†nh c√¥ng!", "success");
                console.log("‚úèÔ∏è ƒê√£ c·∫≠p nh·∫≠t l·ªõp:", newCode);
            }

            function deleteCourse(id) {
                const course = appData.courses.find((c) => c.id === id);
                if (!course) return;

                const enrollmentCount = appData.enrollments.filter(
                    (e) => e.courseCode === course.code
                ).length;

                const confirmMessage =
                    enrollmentCount > 0
                        ? `X√≥a l·ªõp "${course.name}"?\n\nL·ªõp n√†y c√≥ ${enrollmentCount} sinh vi√™n ƒëƒÉng k√Ω. T·∫•t c·∫£ ƒëƒÉng k√Ω s·∫Ω b·ªã x√≥a.`
                        : `X√≥a l·ªõp "${course.name}"?`;

                if (confirm(confirmMessage)) {
                    appData.courses = appData.courses.filter(
                        (c) => c.id !== id
                    );
                    appData.enrollments = appData.enrollments.filter(
                        (e) => e.courseCode !== course.code
                    );

                    saveCourses();
                    saveEnrollments();
                    updateStats();
                    renderCourses();
                    showAlert("‚úÖ ƒê√£ x√≥a l·ªõp h·ªçc!", "success");
                    console.log("üóëÔ∏è ƒê√£ x√≥a l·ªõp:", course.code);
                }
            }

            // ============================================
            // STUDENT MANAGEMENT
            // ============================================
            function renderStudents() {
                const tbody = document.getElementById("studentsTableBody");
                tbody.innerHTML = "";

                if (appData.students.length === 0) {
                    tbody.innerHTML =
                        '<tr><td colspan="6" style="text-align: center; color: #999;">Ch∆∞a c√≥ sinh vi√™n n√†o</td></tr>';
                    return;
                }

                appData.students.forEach((student) => {
                    const canRegisterOfficial = student.highSchoolScore >= 5.0;
                    const row = `
                    <tr>
                        <td style="font-weight: 600; color: #667eea;">${
                            student.studentId
                        }</td>
                        <td>${student.fullName}</td>
                        <td>${student.username}</td>
                        <td>${student.email}</td>
                        <td>${student.highSchoolScore || "N/A"}</td>
                        <td><span class="badge badge--${
                            canRegisterOfficial ? "active" : "remedial"
                        }">${
                        canRegisterOfficial
                            ? "‚úÖ ƒê·ªß ƒëi·ªÅu ki·ªán"
                            : "‚ö†Ô∏è C·∫ßn TƒÉng C∆∞·ªùng"
                    }</span></td>
                        <td>
                            <div class="actions">
                                <button class="btn btn--info" onclick="openEditStudent('${
                                    student.studentId
                                }')">‚úèÔ∏è S·ª≠a</button>
                                <button class="btn btn--danger" onclick="deleteStudent('${
                                    student.studentId
                                }')">üóëÔ∏è X√≥a</button>
                            </div>
                        </td>
                    </tr>
                `;
                    tbody.innerHTML += row;
                });
            }

            function handleAddStudent(e) {
                e.preventDefault();

                const studentId = document
                    .getElementById("studentId")
                    .value.trim();
                const fullName = document
                    .getElementById("studentName")
                    .value.trim();
                const email = document
                    .getElementById("studentEmail")
                    .value.trim();
                const highSchoolScore = parseFloat(
                    document.getElementById("studentScore").value
                );
                const password =
                    document.getElementById("studentPassword").value;

                // Validation
                if (appData.students.find((s) => s.studentId === studentId)) {
                    showAlert("‚ùå M√£ sinh vi√™n ƒë√£ t·ªìn t·∫°i!", "error");
                    return;
                }

                if (appData.students.find((s) => s.email === email)) {
                    showAlert("‚ùå Email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng!", "error");
                    return;
                }

                const newStudent = {
                    studentId,
                    fullName,
                    email,
                    password,
                    highSchoolScore,
                    role: "student",
                    registeredCourses: [],
                };

                appData.students.push(newStudent);
                saveStudents();

                // Th√™m v√†o danh s√°ch users
                const users = JSON.parse(localStorage.getItem("users") || "[]");
                users.push(newStudent);
                localStorage.setItem("users", JSON.stringify(users));

                document.getElementById("studentForm").reset();
                updateStats();
                renderStudents();
                showAlert("‚úÖ Th√™m sinh vi√™n th√†nh c√¥ng!", "success");
                console.log("‚ûï ƒê√£ th√™m sinh vi√™n:", studentId);
            }

            function openEditStudent(studentId) {
                const student = appData.students.find(
                    (s) => s.studentId === studentId
                );
                if (!student) return;

                document.getElementById("editStudentOriginalId").value =
                    student.studentId;
                document.getElementById("editStudentId").value =
                    student.studentId;
                document.getElementById("editStudentName").value =
                    student.fullName;
                document.getElementById("editStudentEmail").value =
                    student.email;
                document.getElementById("editStudentScore").value =
                    student.highSchoolScore;
                document.getElementById("editStudentPassword").value = "";

                document
                    .getElementById("editStudentModal")
                    .classList.add("active");
            }

            function closeEditStudentModal() {
                document
                    .getElementById("editStudentModal")
                    .classList.remove("active");
            }

            function handleEditStudent(e) {
                e.preventDefault();

                const originalId = document.getElementById(
                    "editStudentOriginalId"
                ).value;
                const studentIndex = appData.students.findIndex(
                    (s) => s.studentId === originalId
                );

                if (studentIndex === -1) return;

                const newStudentId = document
                    .getElementById("editStudentId")
                    .value.trim();
                const newEmail = document
                    .getElementById("editStudentEmail")
                    .value.trim();
                const newPassword = document.getElementById(
                    "editStudentPassword"
                ).value;

                // Validation
                if (
                    newStudentId !== originalId &&
                    appData.students.find((s) => s.studentId === newStudentId)
                ) {
                    showAlert("‚ùå M√£ sinh vi√™n ƒë√£ t·ªìn t·∫°i!", "error");
                    return;
                }

                if (
                    newEmail !== appData.students[studentIndex].email &&
                    appData.students.find((s) => s.email === newEmail)
                ) {
                    showAlert("‚ùå Email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng!", "error");
                    return;
                }

                // C·∫≠p nh·∫≠t enrollments n·∫øu thay ƒë·ªïi m√£ sinh vi√™n
                if (newStudentId !== originalId) {
                    appData.enrollments.forEach((enrollment) => {
                        if (enrollment.studentId === originalId) {
                            enrollment.studentId = newStudentId;
                        }
                    });
                    saveEnrollments();
                }

                const updatedStudent = {
                    ...appData.students[studentIndex],
                    studentId: newStudentId,
                    fullName: document
                        .getElementById("editStudentName")
                        .value.trim(),
                    email: newEmail,
                    highSchoolScore: parseFloat(
                        document.getElementById("editStudentScore").value
                    ),
                };

                // C·∫≠p nh·∫≠t m·∫≠t kh·∫©u n·∫øu c√≥
                if (newPassword) {
                    updatedStudent.password = newPassword;
                }

                appData.students[studentIndex] = updatedStudent;
                saveStudents();

                // C·∫≠p nh·∫≠t trong users
                const users = JSON.parse(localStorage.getItem("users") || "[]");
                const userIndex = users.findIndex(
                    (u) =>
                        u.studentId === originalId ||
                        u.email === appData.students[studentIndex].email
                );
                if (userIndex !== -1) {
                    users[userIndex] = updatedStudent;
                    localStorage.setItem("users", JSON.stringify(users));
                }

                renderStudents();
                closeEditStudentModal();
                showAlert("‚úÖ C·∫≠p nh·∫≠t sinh vi√™n th√†nh c√¥ng!", "success");
                console.log("‚úèÔ∏è ƒê√£ c·∫≠p nh·∫≠t sinh vi√™n:", newStudentId);
            }

            function deleteStudent(studentId) {
                const student = appData.students.find(
                    (s) => s.studentId === studentId
                );
                if (!student) return;

                const enrollmentCount = appData.enrollments.filter(
                    (e) => e.studentId === studentId
                ).length;

                const confirmMessage =
                    enrollmentCount > 0
                        ? `X√≥a sinh vi√™n "${student.fullName}"?\n\nSinh vi√™n n√†y ƒëang ƒëƒÉng k√Ω ${enrollmentCount} l·ªõp h·ªçc. T·∫•t c·∫£ ƒëƒÉng k√Ω s·∫Ω b·ªã x√≥a.`
                        : `X√≥a sinh vi√™n "${student.fullName}"?`;

                if (confirm(confirmMessage)) {
                    appData.students = appData.students.filter(
                        (s) => s.studentId !== studentId
                    );
                    saveStudents();

                    appData.enrollments = appData.enrollments.filter(
                        (e) => e.studentId !== studentId
                    );
                    saveEnrollments();

                    // X√≥a kh·ªèi users
                    const users = JSON.parse(
                        localStorage.getItem("users") || "[]"
                    );
                    const updatedUsers = users.filter(
                        (u) => u.studentId !== studentId
                    );
                    localStorage.setItem("users", JSON.stringify(updatedUsers));

                    updateStats();
                    renderStudents();
                    renderCourses();
                    showAlert("‚úÖ ƒê√£ x√≥a sinh vi√™n!", "success");
                    console.log("üóëÔ∏è ƒê√£ x√≥a sinh vi√™n:", studentId);
                }
            }

            // ============================================
            // ENROLLMENT MANAGEMENT
            // ============================================
            function openManageStudents(courseId) {
                const course = appData.courses.find((c) => c.id === courseId);
                if (!course) return;

                appData.managingCourseId = courseId;
                document.getElementById("modalCourseName").textContent =
                    course.name;

                renderEnrolledStudents(course.code);
                populateAvailableStudents(course.code);

                document
                    .getElementById("manageStudentsModal")
                    .classList.add("active");
            }

            function closeModal() {
                document
                    .getElementById("manageStudentsModal")
                    .classList.remove("active");
                appData.managingCourseId = null;
            }

            function renderEnrolledStudents(courseCode) {
                const container = document.getElementById("enrolledStudents");
                const enrolled = appData.enrollments.filter(
                    (e) => e.courseCode === courseCode
                );

                document.getElementById("enrolledCount").textContent =
                    enrolled.length;

                if (enrolled.length === 0) {
                    container.innerHTML =
                        '<p style="text-align: center; color: #999;">Ch∆∞a c√≥ sinh vi√™n n√†o</p>';
                    return;
                }

                container.innerHTML = enrolled
                    .map((enrollment) => {
                        const student = appData.students.find(
                            (s) => s.studentId === enrollment.studentId
                        );
                        if (!student) return "";

                        return `
                    <div class="student-item">
                        <div class="student-info">
                            <div class="student-name">${student.fullName}</div>
                            <div class="student-id">M√£ SV: ${student.studentId} | Email: ${student.email}</div>
                        </div>
                        <button class="btn btn--danger" onclick="removeStudentFromCourse('${student.studentId}', '${courseCode}')">
                            üóëÔ∏è X√≥a
                        </button>
                    </div>
                `;
                    })
                    .join("");
            }

            function populateAvailableStudents(courseCode) {
                const select = document.getElementById("studentToAdd");
                const enrolledIds = appData.enrollments
                    .filter((e) => e.courseCode === courseCode)
                    .map((e) => e.studentId);

                const available = appData.students.filter(
                    (s) => !enrolledIds.includes(s.studentId)
                );

                select.innerHTML =
                    '<option value="">-- Ch·ªçn sinh vi√™n --</option>' +
                    available
                        .map(
                            (s) =>
                                `<option value="${s.studentId}">${s.fullName} (${s.studentId}) - ƒêi·ªÉm: ${s.highSchoolScore}</option>`
                        )
                        .join("");
            }

            function addStudentToCourse() {
                const studentId = document.getElementById("studentToAdd").value;
                if (!studentId) {
                    showAlert("‚ö†Ô∏è Vui l√≤ng ch·ªçn sinh vi√™n!", "error");
                    return;
                }

                const course = appData.courses.find(
                    (c) => c.id === appData.managingCourseId
                );
                if (!course) return;

                const enrolledCount = appData.enrollments.filter(
                    (e) => e.courseCode === course.code
                ).length;

                if (enrolledCount >= course.maxStudents) {
                    showAlert("‚ùå L·ªõp ƒë√£ ƒë·∫ßy!", "error");
                    return;
                }

                const newEnrollment = {
                    id: Date.now(),
                    studentId: studentId,
                    courseCode: course.code,
                    enrollDate: new Date().toISOString(),
                };

                appData.enrollments.push(newEnrollment);
                saveEnrollments();
                updateStats();
                renderCourses();
                renderEnrolledStudents(course.code);
                populateAvailableStudents(course.code);
                showAlert("‚úÖ ƒê√£ th√™m sinh vi√™n v√†o l·ªõp!", "success");
                console.log(
                    "‚ûï ƒê√£ th√™m sinh vi√™n v√†o l·ªõp:",
                    studentId,
                    "->",
                    course.code
                );
            }

            function removeStudentFromCourse(studentId, courseCode) {
                if (confirm("X√≥a sinh vi√™n kh·ªèi l·ªõp?")) {
                    appData.enrollments = appData.enrollments.filter(
                        (e) =>
                            !(
                                e.studentId === studentId &&
                                e.courseCode === courseCode
                            )
                    );

                    saveEnrollments();
                    updateStats();
                    renderCourses();
                    renderEnrolledStudents(courseCode);
                    populateAvailableStudents(courseCode);
                    showAlert("‚úÖ ƒê√£ x√≥a sinh vi√™n kh·ªèi l·ªõp!", "success");
                    console.log(
                        "üóëÔ∏è ƒê√£ x√≥a sinh vi√™n kh·ªèi l·ªõp:",
                        studentId,
                        "->",
                        courseCode
                    );
                }
            }

            // ============================================
            // UTILITY FUNCTIONS
            // ============================================
            function showAlert(message, type = "success") {
                const alert = document.createElement("div");
                alert.className = `alert alert--${type}`;
                alert.textContent = message;

                const container = document.querySelector(".container");
                container.insertBefore(alert, container.firstChild);

                setTimeout(() => {
                    alert.style.animation = "slideIn 0.3s reverse";
                    setTimeout(() => alert.remove(), 300);
                }, 3000);
            }
        </script>
    </body>
</html>
